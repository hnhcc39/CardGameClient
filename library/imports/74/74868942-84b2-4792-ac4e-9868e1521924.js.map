{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "//处理对战流程的关键类\r\n\r\nconst Player = require('player');\r\nconst ChatWnd = require('ChatWnd');\r\nconst PlayerSprite = require('PlayerSprite');\r\nvar GameConn = require('./NetWork/GameConn');\r\n//var EventProcess = require('./Network/EventProcess');\r\n\r\n//对战状态\r\nvar DUEL_STATE_REST = 0;\r\nvar DUEL_STATE_PLAYING = 1;\r\n\r\n//分组\r\nvar TEAM_COLOR_NONE = -1;\r\nvar TEAM_COLOR_RED = 1;\r\nvar TEAM_COLOR_BLUE = 2;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        \r\n        playerVec: [],\r\n        state : DUEL_STATE_REST,\r\n        \r\n        turn: 0,            //每个玩家一回合加一次\r\n        round: 0,           //每个玩家都行动过一回合加一次\r\n\r\n        //-----------------------控件-------------------------------------------\r\n        cardPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        \r\n        playerSpriteVec: [PlayerSprite],    //玩家控件\r\n\r\n        //聊天窗口脚本\r\n        chatWnd: {\r\n            default: null,\r\n            type: ChatWnd\r\n        },\r\n    },\r\n    \r\n    setInputControl: function() {\r\n        var self = this;\r\n        this.node.on('touchstart', function(event) {\r\n            cc.log('1231312321313213123');\r\n            cc.log(event.getLocationX());\r\n        }, this);\r\n\r\n    },\r\n    \r\n    addPlayer: function(param) {\r\n        var idx = param;\r\n        var player = this.duel.playerVec[idx];\r\n        //玩家数据已存在\r\n        if(player)\r\n        {\r\n            cc.log('WC_PLAYER_ADD error! player(%d) is already exited.', idx);\r\n            return;\r\n        }\r\n        \r\n        //创建玩家并加入玩家数组\r\n        createPlayer(param);\r\n        \r\n        GameConn.sendPacket(CW_DUELREADY_REQUEST, {});  //直接准备\r\n    },\r\n    \r\n    createPlayer: function(param) {\r\n        var player = new Player();\r\n        player.init(this);\r\n        player.unpackDataAll(param);\r\n        this.playerVec[idx] = player;\r\n    },\r\n    \r\n    getPlayer: function(idx) {\r\n        return this.playerVec[idx];    \r\n    },\r\n    \r\n    getPlayerSprite: function(idx) {\r\n        return this.playerSpriteVec[idx];    \r\n    },\r\n    \r\n    refreshPlayerSprite: function(playerIdx) {\r\n        for(var playerSprite of this.playerSpriteVec)    \r\n        {\r\n            if(playerSprite.getIdx() === playerIdx)\r\n            {\r\n                playerSprite.refresh();\r\n                break;\r\n            }\r\n        }\r\n    },\r\n    \r\n    //开始游戏\r\n    startGame: function() {\r\n        //玩家初始化\r\n        this.localPlayer.init(this);\r\n        this.opponentPlayer.init(this);\r\n        \r\n        //根据牌池生成卡组\r\n        this.localPlayer.createDeck(tempDeck);\r\n        this.opponentPlayer.createDeck(tempDeck);\r\n        \r\n        //初始化对手player,\r\n        this.localPlayer._opponentPlayer = this.opponentPlayer;\r\n        this.opponentPlayer._opponentPlayer = this.localPlayer;\r\n        \r\n        var isFirstPlayer = true;   //先手后手\r\n        \r\n        if(isFirstPlayer)\r\n        {\r\n            this.turnPlayer = this.localPlayer;\r\n            this.turnOpponent = this.opponentPlayer;\r\n        }\r\n        else\r\n        {\r\n            this.turnPlayer = this.opponentPlayer;\r\n            this.turnOpponent = this.localPlayer;            \r\n        }\r\n        \r\n        this.turn = 1;\r\n        \r\n        this.turnPlayer.drawDeck(3);\r\n        this.turnOpponent.drawDeck(3);\r\n        this.changePhase(PHASE_BEGIN_TURN);\r\n        \r\n       //showTipLabel('开始游戏');\r\n    },\r\n    \r\n    //交换行动\r\n    turnPlayerChange: function() {\r\n        //cc.log('turnPlayerChange, turnPlayer:%s, turnOpponent:%s', this.turnPlayer.heroName, this.turnOpponent.heroName);\r\n        var tempPlayer = this.turnPlayer;\r\n        //cc.log('tempPlayerName:%s', tempPlayer.heroName);\r\n        this.turnPlayer = this.turnOpponent;\r\n        //cc.log('turnPlayer:%s', this.turnPlayer.heroName);\r\n\r\n        this.turnOpponent = tempPlayer;\r\n        //cc.log('turnopponent:%s', this.turnOpponent.heroName);\r\n\r\n    },\r\n    \r\n    //随从攻击玩家\r\n    monsterAtkPlayer: function(monster, player) {\r\n        if(!monster || monster.atk <= 0 || monster.isAtked === true)\r\n            return;\r\n                \r\n        monster.isAtked = true;\r\n        player.reduceHp(monster.atk);\r\n        player.refreshMonsterField();\r\n        \r\n        showTipLabel(monster._player.heroName + '的' + monster.cardName + ' 攻击了玩家 ' + player.heroName);\r\n\r\n        this.checkWin();\r\n    },\r\n    \r\n    //随从攻击随从\r\n    monsterAtkMonster: function(src, dest) {\r\n        if(!src || !dest || src.atk <= 0 || src.isAtked === true)\r\n            return;\r\n    \r\n        src.isAtked = true;\r\n        var damage = src.atk;\r\n        dest.reduceHp(damage);\r\n        \r\n        damage = dest.atk;\r\n        src.reduceHp(damage);\r\n        \r\n        showTipLabel(src._player.heroName + '的' + src.cardName + ' 攻击了 ' + dest._player.heroName + '的' + dest.cardName, cc.Color.RED);\r\n    },\r\n    \r\n    //判断输赢\r\n    checkWin: function() {\r\n        if(this.turnPlayer.hp <= 0 && this.turnOpponent.hp <= 0)\r\n        {\r\n            showTipLabel(\"平局\");\r\n        }\r\n        else if(this.turnPlayer.hp <= 0)\r\n        {\r\n            showTipLabel(\"%s 胜利\", this.opponentPlayer.heroName);\r\n        }\r\n        else if(this.turnOpponent.hp <= 0)\r\n        {\r\n            showTipLabel(\"% 胜利\", this.turnPlayer.heroName);\r\n        }\r\n    },\r\n    \r\n    //回合结束（按钮调用）\r\n    turnEnd_BtnEvent: function(event) {\r\n        //不是MainPhase这个按钮不能按\r\n        if(this.phaseState !== PHASE_MAIN_TURN)\r\n            return;\r\n            \r\n        this.changePhase(PHASE_END_TURN);\r\n    },\r\n    \r\n    addChatItem: function(message, color) {\r\n        this.chatWnd.addChatItem(message, color);\r\n        //this.chatWnd.addChatItem('[系统]:用户' + GameConn.getAccountName() + '进入了房间.', cc.Color.RED);\r\n    },\r\n    \r\n    enterBeginTurn: function() {\r\n        cc.log('is enter BeginTurn?');\r\n        ++this.turn;\r\n        this.turnPlayerChange();\r\n        \r\n        showTipLabel(this.turnPlayer.heroName + '的回合');\r\n        this.turnPlayer.setTurnActive(true);    //可以行动\r\n        this.turnPlayer.criticalPlus(1);        //增加水晶\r\n        this.turnPlayer.criticalRecover();      //回复水晶\r\n        this.turnPlayer.awakenMonster();        //重置随从攻击次数\r\n        this.turnPlayer.drawDeck(1);            //抽1张卡\r\n        \r\n    },\r\n    \r\n    beginTurn: function(){\r\n        //进入主流程\r\n        \r\n        this.changePhase(PHASE_MAIN_TURN);\r\n    },\r\n    \r\n    leaveBeginTurn: function() {\r\n\r\n    },\r\n    \r\n    enterMainTurn: function() {\r\n        \r\n    },\r\n    \r\n    mainTurn: function(){\r\n        \r\n    },\r\n    \r\n    leaveMainTurn: function() {\r\n        \r\n    },\r\n    \r\n    enterEndTurn: function() {\r\n        \r\n    },\r\n    \r\n    endTurn: function(){\r\n        this.changePhase(PHASE_BEGIN_TURN);\r\n    },\r\n    \r\n    leaveEndTurn: function() {\r\n        \r\n        this.turnPlayer.setTurnActive(false);\r\n    },\r\n        \r\n    changePhase: function(nextTurnType) {\r\n        if(this.phaseState !== 0)\r\n        {\r\n            this.leaveTurnFunc[this.phaseState]();\r\n        }\r\n        \r\n        this.enterTurnFunc[nextTurnType]();\r\n        this.phaseState = nextTurnType;\r\n    },\r\n    \r\n    // use this for initialization\r\n    onLoad: function () {\r\n        //this.setInputControl();\r\n        //初始化玩家控件\r\n        for(var playerSprite of this.playerSpriteVec)\r\n        {\r\n            playerSprite.init(this);\r\n        }\r\n    },\r\n\r\n    start: function() {\r\n        //this.startGame();\r\n        EventProcess.setDuel(this);\r\n        GameConn.sendPacket(CW_ENTERROOM_REQUEST, {});  //用户进入房间请求\r\n    },\r\n    \r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n        //this.turnFunc[this.phaseState]();\r\n    },\r\n});\r\n"
  ]
}